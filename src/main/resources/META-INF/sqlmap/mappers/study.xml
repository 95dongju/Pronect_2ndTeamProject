<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.google.pronect.dao.StudyDao">
	<resultMap type="Study" id="StudyResult">
		<result property="sid" column="sid"/>
		<result property="mid" column="mid"/>
		<result property="stitle" column="stitle"/>
		<result property="scontent" column="scontent"/>
		<result property="speople" column="speople"/>
		<result property="slanguage1" column="slanguage1"/>
		<result property="slanguage2" column="slanguage2"/>
		<result property="slanguage3" column="slanguage3"/>
		<result property="srdate" column="srdate"/>
		<result property="ssdate" column="ssdate"/>
		<result property="sfdate" column="sfdate"/>
		<result property="shit" column="shit"/>
		<result property="sloc" column="sloc"/>
		<result property="scomplete" column="scomplete"/>
		<result property="startRow" column="startRow"/>
		<result property="endRow" column="endRow"/>
	</resultMap>
	<select id="studyList" parameterType="Study" resultMap="StudyResult">
		SELECT * FROM 
    (SELECT ROWNUM RN, A.* FROM
        (SELECT * FROM STUDY WHERE SCOMPLETE = 'N' ORDER BY SID DESC) A) 
		WHERE RN BETWEEN #{startRow} AND #{endRow}
	</select>
	<select id="studyTotCnt" resultType="int">
		SELECT COUNT(*) FROM STUDY WHERE SCOMPLETE = 'N'
	</select>
	<insert id="registerGroup" parameterType="Study">
		INSERT INTO STUDY (SID, MID, STITLE, SCONTENT, SPEOPLE, 
                    SLANGUAGE1, SLANGUAGE2, SLANGUAGE3, SSDATE, SFDATE, SLOC)
            VALUES(STUDY_SEQ.NEXTVAL, #{mid},#{stitle},#{scontent},#{speople},
                    #{slanguage1},#{slanguage2},#{slanguage3},#{ssdate},#{sfdate},#{sloc})
	</insert>
	<select id="getRegisteredSid" parameterType="String" resultType="int">
		SELECT SID FROM STUDY WHERE MID = #{mid} AND  SCOMPLETE = 'N'
	</select>
	<insert id="insertHistory" parameterType="Study">
		INSERT INTO SSTATUS (SSID, MID, SID, SSSTATUS)
            VALUES (SSTATUS_SEQ.NEXTVAL, #{mid},#{sid},2)
	</insert>
	<select id="getStudyDetail" parameterType="int" resultType="Study">
		SELECT * FROM STUDY WHERE SID = #{sid}
	</select>
	<update id="modifyStudy" parameterType="Study">
		UPDATE STUDY SET STITLE = #{stitle},
                SCONTENT = #{scontent},
                SPEOPLE = #{speople},
                SLANGUAGE1 = #{slanguage1},
                SLANGUAGE2 = #{slanguage2},
                SLANGUAGE3 = #{slanguage3},
                SSDATE = #{ssdate},
                SFDATE = #{sfdate},
                SLOC = #{sloc}
        WHERE SID = #{sid}
	</update>
	<update id="deleteHistory" parameterType="int">
		UPDATE SSTATUS SET SSSTATUS = 4 WHERE SID = #{sid}
	</update>
	<update id="deleteStudy" parameterType="int">
		UPDATE STUDY SET SCOMPLETE = 'D' WHERE SID = #{sid}
	</update>
	<insert id="joinStudy" parameterType="Study">
		INSERT INTO SSTATUS (SSID, MID, SID, SSSTATUS)
            VALUES (SSTATUS_SEQ.NEXTVAL, #{mid},#{sid},1)
	</insert>
	<update id="acceptStudy" parameterType="String">
		UPDATE SSTATUS SET SSSTATUS = 2 WHERE MID = #{mid}
	</update>
	<update id="completeStudy" parameterType="int">
		UPDATE SSTATUS SET SSSTATUS = 3 WHERE SID = #{sid}
	</update>
	
</mapper>